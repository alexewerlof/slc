<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Service Level Calculator</title>
</head>
<body>
    <noscript>
        <p>This web application requires JavaScript to work.</p>
    </noscript>
    <header>
        <h1>Service Level Calculator</h1>
    </header>
    
    <ul id="links-bar">
        <li><a href="#sli-title">SLI</a></li>
        <li><a href="#slo-title">SLO</a></li>
        <li><a href="#error-budget-title">Error Budget</a></li>
        <li><a href="#alert-title">Alert</a></li>
    </ul>

    <main id="app" v-cloak>
        <h1 id="sli-title">SLI</h1>
        <label>
            <h2>Event unit</h2>
            <input type="text" v-model="sli.eventUnit">
        </label>
        <label>
            <h2>Good {{sli.eventUnit}}</h2>
            <input type="text" v-model="sli.good">
        </label>
        <label>
            <h2>Valid {{sli.eventUnit}}</h2>
            <input type="text" v-model="sli.valid">
        </label>
    
        <h2>Type</h2>
        <label>
            <input type="checkbox" v-model="sli.isTimeBased">
            Time based
        </label>
        <label v-if="sli.isTimeBased">
            <h3>Aggregation Period</h3>
            <select v-model="sli.aggregationPeriod">
                <option value="60">1 minute</option>
                <option value="180">3 minutes</option>
                <option value="300">5 minutes</option>
                <option value="600">10 minutes</option>
                <option value="900">15 minutes</option>
                <option value="1800">30 minutes</option>
                <option value="3600">1 hour</option>
            </select>
        </label>

        <div v-show="sli.good">
            <h2>Formula</h2>
            <code v-if="!sli.isTimeBased">
                SLI = sum({{sli.good}}) / sum({{sli.valid}}) * 100
            </code>
            <code v-if="sli.isTimeBased">
                SLI = sum({{sli.good}}, {{secondsToTimePeriod(sli.aggregationPeriod)}}) / sum({{sli.valid}}, secondsToTimePeriod({{sli.aggregationPeriod}})) * 100
            </code>
        </div>

        <h1 id="slo-title">SLO: {{slo.perc}}%</h1>
        
        <label>
            <h2>{{ sloInt }}%</h2>
            <input type="range" min="0" max="99" v-model="sloInt">
        </label>
        <label>
            <h2>+ {{ sloFrac }}%</h2>
            <input type="range" min="0" max="0.999" step="0.001" v-model="sloFrac">
        </label>

        <h2>Compliance Period: <label for="slo-window-unit-multiplier">{{ secondsToTimePeriod(windowSec) }}</label></h2>

        <input type="range" min="1" :max="slo.windowUnit.max" v-model="slo.windowMult" id="slo-window-unit-multiplier">

        <label v-for="windowUnit in windowUnits" :key="windowUnit.title" class="spaced">
            <input type="radio" name="windowUnit" :value="windowUnit" v-model="slo.windowUnit" @click="slo.windowMult = 1">
            {{ windowUnit.title }}
        </label>

        <p>
            <time>{{windowSec}} sec</time>
        </p>
    
        <h1 id="error-budget-title">Error budget</h1>
        <div v-if="sli.isTimeBased">
            <p>
                {{errorBudget.perc}}% of
                <time>{{ secondsToTimePeriod(windowSec) }}</time>
                =
                <time>{{ secondsToTimePeriod(downTime) }}</time>
            </p>
            <p>
                <time>{{downTime}}</time> sec
            </p>
        </div>
        <div v-if="!sli.isTimeBased">
            <p>
                {{errorBudget.perc}}%
            </p>
        </div>

        <h2>Example</h2>
        <label>
            <h3>{{sli.good}} #{{sli.eventUnit}} in <time>{{secondsToTimePeriod(windowSec)}}</time></h3>
            <input type="number" v-model="sli.goodExample">
        </label>
        <p>
            To hit a slo of <em>{{slo.perc}}%</em> for
            <em>{{sli.goodExample}}</em> {{sli.eventUnit}} where <code>{{sli.good}}</code>
            in <time>{{secondsToTimePeriod(windowSec)}}</time>,
            you need to have a total of <em>{{totalTarget}}</em> valid {{sli.eventUnit}}.
            <br/>
            This allows a maximum of <em>{{totalTarget - sli.goodExample}}</em> invalid {{sli.eventUnit}}
            in this period.
        </p>
        <label>
            <h3>{{sli.valid}} #{{sli.eventUnit}} in <time>{{secondsToTimePeriod(windowSec)}}</time></h3>
            <input type="number" v-model="sli.validExample">
        </label>
        <p>
            To hit a slo of <em>{{slo.perc}}%</em> for
            <em>{{sli.validExample}}</em> <code>{{sli.valid}}</code> {{sli.eventUnit}}
            in <time>{{secondsToTimePeriod(windowSec)}}</time>,
            you need to have a total of <em>{{goodTarget}}</em> good {{sli.eventUnit}}.
            <br/>
            This allows a maximum of <em>{{sli.validExample - goodTarget}}</em> bad {{sli.eventUnit}}
            in this period.
        </p>

        <h3>Current</h3>
        <p>
            The way it stands, your SLI is {{exampleTarget}}%.
            (your target is {{slo.perc}}%)
        </p>

        <h1 id="alert-title">Alert</h1>
        <p>Upcoming...</p>

    </main>

    <footer>Copyright (C) 2023 <a href="https://alexewerlof.com">Alex Ewerlof</a> | <a href="https://github.com/userpixel/slo">Github</a> | <a href="https://vuejs.org/">Uses Vue</a> | <a href="https://blog.alexewerlof.com/p/why-bother-with-sli-and-slo">Why bother?</a></footer>

    <script type="module" src="index.js"></script>
</body>
</html>