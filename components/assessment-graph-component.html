<div class="assessment-graph-component">
    <svg :viewBox="`0 0 ${width} ${height}`" :width="width" :height="height" @click.self="$emit('select', undefined)">
        <!-- Tasks & Consumers -->
        <g v-for="consumer of assessment.consumers">
            <g v-for="task of consumer.tasks">
                <path
                    class="assessment-graph-component__line assessment-graph-component__line--relation"
                    :d="d(consumerX(consumer), consumerY(consumer), taskX(task), taskY(task))"></path>
                <path
                    class="assessment-graph-component__line assessment-graph-component__line--task-dependency"
                    :d="d(taskX(task), taskY(task), width, taskY(task))"></path>
                <assessment-graph-component-entity
                    :is-selected="selectedEntity === task"
                    :has-notification="task.lint.count"
                    type="task"
                    :cx="taskX(task)"
                    :cy="taskY(task)"
                    :tooltip="task.markdownDisplayName"
                    @click="$emit('select', task)"
                    @status="updateStatus"
                    >
                    {{ unicodeSymbol('task') }}
                </assessment-graph-component-entity>
            </g>
            <assessment-graph-component-entity
                :is-selected="selectedEntity === consumer"
                :has-notification="consumer.lint.count"
                type="consumer"
                :cx="consumerX(consumer)"
                :cy="consumerY(consumer)"
                :tooltip="consumer.markdownDisplayName"
                @click="$emit('select', consumer)"
                @status="updateStatus"
                >
                {{ unicodeSymbol('consumer') }}
            </assessment-graph-component-entity>
        </g>
        <!-- Services & Providers -->
        <g v-for="provider of assessment.providers">
            <g v-for="service of provider.services">
                <path
                    class="assessment-graph-component__line assessment-graph-component__line--relation"
                    :d="d(providerX(provider), providerY(provider), serviceX(service), serviceY(service))"></path>
                <path
                    class="assessment-graph-component__line assessment-graph-component__line--service-dependency"
                    :d="d(serviceX(service), serviceY(service), serviceX(service), height)"></path>
                <assessment-graph-component-entity
                    :is-selected="selectedEntity === service"
                    :has-notification="service.lint.count"
                    type="service"
                    :cx="serviceX(service)"
                    :cy="serviceY(service)"
                    :tooltip="service.markdownDisplayName"
                    @click="$emit('select', service)"
                    @status="updateStatus"
                    >
                    {{ unicodeSymbol('service') }}
                </assessment-graph-component-entity>
                <!-- Dependencies -->
                <assessment-graph-component-entity
                    v-for="dependency of service.dependencies"
                    :is-selected="selectedEntity === dependency"
                    :has-notification="dependency.lint.count"
                    type="dependency"
                    :cx="dependencyX(dependency)"
                    :cy="dependencyY(dependency)"
                    :tooltip="dependency.markdownDisplayName"
                    @click="$emit('select', dependency)"
                    @status="updateStatus"
                    >
                    {{ dependency.failures.length }}
                </assessment-graph-component-entity>
                <!-- Metrics -->
                <assessment-graph-component-entity
                    v-for="metric of service.metrics"
                    :is-selected="selectedEntity === metric"
                    :has-notification="metric.lint.count"
                    type="metric"
                    :cx="metricX(metric)"
                    :cy="metricY(metric)"
                    :tooltip="metric.markdownDisplayName"
                    @click="$emit('select', metric)"
                    @status="updateStatus"
                    >
                    {{ unicodeSymbol('metric') }}
                </assessment-graph-component-entity>
            </g>
            <!-- Provider -->
            <assessment-graph-component-entity
                :is-selected="selectedEntity === provider"
                :has-notification="provider.lint.count"
                type="provider"
                :tooltip="provider.markdownDisplayName"
                :cx="providerX(provider)"
                :cy="providerY(provider)"
                @click="$emit('select', provider)"
                @status="updateStatus"
                >
                {{ unicodeSymbol('provider') }}
            </assessment-graph-component-entity>
        </g>
    </svg>
    <div class="assessment-graph-component__status-bar"
        :style="statusStyle">{{ statusText }}</div>
</div>
